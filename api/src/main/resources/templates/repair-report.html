<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
            margin: 0;
            padding: 30px;
            color: #000;
            line-height: 1.5;
        }

        .header {
            width: 100%;
            border-bottom: 2px solid #000;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        .header-content {
            width: 100%;
        }

        .company-info {
            float: left;
            width: 65%;
        }

        .company-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .company-details {
            font-size: 11px;
            line-height: 1.3;
        }

        .logo-section {
            float: right;
            width: 30%;
            text-align: right;
        }

        .logo-section img {
            max-height: 60px;
            max-width: 120px;
        }

        .clearfix {
            clear: both;
        }

        .title {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            text-transform: uppercase;
            text-decoration: underline;
        }

        .info-grid {
            width: 100%;
            margin-bottom: 20px;
        }

        .info-left {
            float: left;
            width: 48%;
        }

        .info-right {
            float: right;
            width: 48%;
        }

        .info-card {
            padding: 10px 0;
            margin-bottom: 15px;
        }

        .info-card h3 {
            margin: 0 0 8px 0;
            font-size: 14px;
            font-weight: bold;
            text-decoration: underline;
        }

        .info-item {
            margin-bottom: 6px;
            width: 100%;
        }

        .info-label {
            font-weight: bold;
            display: inline-block;
            width: 90px;
            margin-right: 10px;
        }

        .info-value {
            display: inline;
        }

        .complaint-section {
            padding: 10px 0;
            margin-bottom: 20px;
            clear: both;
        }

        .complaint-section h3 {
            margin: 0 0 8px 0;
            font-size: 14px;
            font-weight: bold;
            text-decoration: underline;
        }

        .complaint-text {
            padding: 8px 0;
            font-style: italic;
        }

        .details-section {
            margin-bottom: 20px;
            clear: both;
        }

        .details-section h3 {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            text-decoration: underline;
        }

        .details-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #000;
        }

        .details-table th {
            background: #f0f0f0;
            padding: 10px;
            font-weight: bold;
            text-align: left;
            font-size: 12px;
            border: 1px solid #000;
        }

        .details-table td {
            padding: 8px 10px;
            border: 1px solid #000;
            font-size: 11px;
        }

        .price-cell {
            text-align: right;
            font-weight: bold;
        }

        .total-section {
            text-align: right;
            margin-top: 15px;
            padding: 10px 0;
            clear: both;
        }

        .total-text {
            font-size: 16px;
            font-weight: bold;
        }

        .date-range {
            margin-top: 8px;
        }

        .date-item {
            margin-bottom: 4px;
        }

        .footer {
            position: fixed;
            bottom: 20px;
            left: 30px;
            right: 30px;
            text-align: center;
            font-size: 10px;
            border-top: 1px solid #000;
            padding-top: 15px;
            background: white;
        }

        .footer-conditions {
            margin-top: 10px;
            text-align: left;
        }

        .footer-conditions h4 {
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 8px;
            text-decoration: underline;
        }

        .footer-conditions ul {
            list-style-type: disc;
            margin: 0;
            padding-left: 20px;
        }

        .footer-conditions li {
            margin-bottom: 3px;
            font-size: 9px;
            line-height: 1.3;
        }

        /* Page break styles */
        .page-break {
            page-break-before: always;
        }

        .conditions-page {
            margin-top: 30px;
        }

        .conditions-page h2 {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            text-decoration: underline;
        }

        .conditions-content {
            font-size: 12px;
            line-height: 1.6;
            text-align: justify;
        }

        .conditions-content ol {
            padding-left: 20px;
        }

        .conditions-content li {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
<!-- Header avec logo et informations entreprise -->
<div class="header">
    <div class="header-content">
        <div class="company-info">
            <div class="company-name">[[${companyName}]]</div>
            <div class="company-details">
                <div>Adresse: [[${companyAddress}]]</div>
                <div>Téléphone: [[${companyPhoneNumber}]]</div>
                <div>Email: [[${companyEmail}]]</div>
            </div>
        </div>
        <div class="logo-section" th:if="${logo != null}">
            <img th:src="'data:image/png;base64,' + ${logo}" alt="Logo" />
        </div>
        <div class="clearfix"></div>
    </div>
</div>

<!-- Titre principal -->
<div class="title">Rapport de Réparation</div>

<!-- Informations en deux colonnes -->
<div class="info-grid">
    <!-- Informations de l'intervention -->
    <div class="info-left">
        <div class="info-card">
            <h3>Détails de l'Intervention</h3>
            <div class="info-item">
                <span class="info-label">N° d'appel:</span>
                <span class="info-value">[[${callNumber}]]</span>
            </div>
            <div class="date-range">
                <div class="date-item">
                    <span class="info-label">Date d'entrée:</span>
                    <span class="info-value">[[${#temporals.format(entryDate, 'dd/MM/yyyy')}]]</span>
                </div>
                <div class="date-item">
                    <span class="info-label">Date de sortie:</span>
                    <span class="info-value">[[${#temporals.format(releaseDate, 'dd/MM/yyyy')}]]</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Informations de la machine -->
    <div class="info-right">
        <div class="info-card">
            <h3>Informations Machine</h3>
            <div class="info-item">
                <span class="info-label">Machine:</span>
                <span class="info-value">[[${machineDesignation}]]</span>
            </div>
            <div class="info-item">
                <span class="info-label">Référence:</span>
                <span class="info-value">[[${machineReference}]]</span>
            </div>
            <div class="info-item">
                <span class="info-label">Client:</span>
                <span class="info-value">[[${clientName}]]</span>
            </div>
        </div>
    </div>

    <div class="clearfix"></div>
</div>

<!-- Réclamation client -->
<div class="complaint-section">
    <h3>Réclamation Client</h3>
    <div class="complaint-text">
        [[${complaint}]]
    </div>
</div>

<!-- Détails de la réparation - Only show if details list is not empty -->
<div th:if="${details != null and !details.isEmpty()}" class="details-section">
    <h3>Détails de la Réparation</h3>
    <table class="details-table">
        <thead>
        <tr>
            <th style="width: 70%;">Description des Travaux</th>
            <th style="width: 30%;">Prix (TND)</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="d : ${details}">
            <td th:text="${d.description}">Description</td>
            <td class="price-cell" th:text="${#numbers.formatDecimal(d.price, 1, 'COMMA', 2, 'POINT')}">0.00</td>
        </tr>
        </tbody>
    </table>
</div>

<!-- Total - Only show if details list is not empty -->
<div th:if="${details != null and !details.isEmpty()}" class="total-section">
    <div class="total-text">Total : [[${total}]] TND</div>
</div>

<!-- Footer -->
<div class="footer">
    <p>Merci de votre confiance</p>
    <p>Pour toute question, contactez-nous au [[${companyPhoneNumber}]] ou [[${companyEmail}]]</p>

    <!-- General conditions in footer (for short conditions) -->
    <div th:if="${showConditionsInFooter}" class="footer-conditions">
        <h4>Conditions Générales</h4>
        <ul>
            <li th:each="condition : ${conditionsList}" th:text="${condition}"></li>
        </ul>
    </div>
</div>

<!-- Separate page for general conditions (for long conditions) -->
<div th:if="${showConditionsOnSeparatePage}" class="page-break conditions-page">
    <h2>Conditions Générales</h2>
    <div class="conditions-content">
        <ol>
            <li th:each="condition : ${conditionsList}" th:text="${condition}"></li>
        </ol>
    </div>
</div>

</body>
</html>