import{c as C,u as S,a as A,r as E,j as e,y as m}from"./index-yGwYt6Nq.js";import{u as O,s as T}from"./index-DPb_3Eze.js";import{d as R,e as k,E as z,P as L,C as U,b as B,A as F,c as M}from"./hooks-BR9cMY9c.js";import{C as x,a as u}from"./Card-v3_dQfcZ.js";import{B as c}from"./button-C8D8pBz3.js";import{u as $}from"./hooks-D8JWOBQf.js";import"./label-wM3WakGA.js";import"./index-CIc1txwD.js";import"./index-Y2e7ilkQ.js";import"./index-D4j-s7ve.js";import"./request-DFzFQ-HD.js";import"./user-Bd4vM0qs.js";import"./Input-BljE3152.js";import"./Button-nvBNfKxG.js";import"./map-pin-DejgNk_T.js";import"./useMutation-B29Hiwaj.js";import"./index-BDwWvORE.js";import"./useQuery-wnBeM4WK.js";import"./api-CwCx7HfZ.js";/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],V=C("arrow-left",G),ce=()=>{const{id:h}=S(),n=A(),N=h?parseInt(h,10):-1,{data:s,isPending:y,error:f}=$(N),{mutate:j,isPending:b}=R((s==null?void 0:s.id)||0),{mutate:v,isPending:w}=k((s==null?void 0:s.id)||0),p=b||w,i=O({resolver:T(M),defaultValues:{phoneNumbers:[{number:""}],addresses:[{streetAddress:"",city:""}],basicInfo:{firstName:"",lastName:""}}});E.useEffect(()=>{var a,o;s&&i.reset({entityType:s.entityType,phoneNumbers:((a=s.phoneNumbers)==null?void 0:a.length)>0?s.phoneNumbers.map(l=>({number:l.number})):[{number:void 0}],addresses:((o=s.addresses)==null?void 0:o.length)>0?s.addresses.map(l=>({streetAddress:l.streetAddress,city:l.city})):[{streetAddress:void 0,city:void 0}],basicInfo:s.entityType==="PERSON"?{firstName:s.firstName||void 0,lastName:s.lastName||void 0}:{companyName:s.companyName||void 0,registrationNumber:s.registrationNumber||void 0,taxNumber:s.taxNumber||void 0}})},[s,i]);const g=i.watch("entityType"),P=async a=>{if(!s)return;const o=a.phoneNumbers.map(t=>({number:t.number})),l=a.addresses.map(t=>({streetAddress:t.streetAddress,city:t.city}));if(a.entityType==="PERSON"){const t=a.basicInfo,d={...s,entityType:"PERSON",phoneNumbers:o,addresses:l,firstName:t.firstName,lastName:t.lastName};console.log("updated person:",d),j(d,{onSuccess:r=>{m.success(r.message),n(`/clients/${s.id}`)},onError:r=>{m.error(r.message),console.log("error : "+r.message)}})}else{const t=a.basicInfo,d={...s,entityType:"ORGANIZATION",phoneNumbers:o,addresses:l,companyName:t.companyName,registrationNumber:t.registrationNumber,taxNumber:t.taxNumber};console.log("updated organization:",d),v(d,{onSuccess:r=>{m.success(r.message),n(`/clients/${s.id}`)},onError:r=>{m.error(r.message)}})}},I=()=>{n(`/clients/${(s==null?void 0:s.id)||""}`)};return y?e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-7xl",children:e.jsx("div",{className:"flex justify-center items-center min-h-64",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Chargement des données du client..."})]})})}):f||!s?e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-7xl",children:e.jsx("div",{className:"flex justify-center items-center min-h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"⚠️"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Client non trouvé"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Le client que vous essayez de modifier n'existe pas ou n'est plus disponible."}),e.jsx(c,{onClick:()=>n("/clients"),children:"Retour à la liste des clients"})]})})}):N===-1?e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-7xl",children:e.jsx("div",{className:"flex justify-center items-center min-h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"🔍"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"ID client invalide"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"L'identifiant du client fourni n'est pas valide."}),e.jsx(c,{onClick:()=>n("/clients"),children:"Retour à la liste des clients"})]})})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"container mx-auto px-4 py-4 max-w-7xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(c,{variant:"ghost",onClick:()=>n("/clients"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[e.jsx(V,{className:"h-4 w-4"}),"Retour à la liste"]}),e.jsx("div",{className:"h-6 w-px bg-gray-300"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Modifier le client"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.entityType==="PERSON"?s.fullName:s.companyName})]})]}),e.jsx(c,{variant:"ghost",onClick:()=>n(`/clients/${s.id}`),className:"text-gray-600 hover:text-gray-900",children:"Voir les détails"})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-6 max-w-7xl",children:e.jsxs("form",{onSubmit:i.handleSubmit(P),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsx("div",{className:"lg:col-span-4",children:e.jsx(x,{className:"h-full",children:e.jsx(u,{children:e.jsx(z,{value:g,onChange:()=>{}})})})}),e.jsx("div",{className:"lg:col-span-8",children:e.jsx(x,{className:"h-full",children:e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Informations de base"}),g==="PERSON"?e.jsx(L,{form:i}):e.jsx(U,{form:i})]})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(x,{className:"h-full",children:e.jsx(u,{children:e.jsx(B,{form:i})})})}),e.jsx("div",{children:e.jsx(x,{className:"h-full",children:e.jsx(u,{children:e.jsx(F,{form:i})})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-4 pt-6 border-t border-gray-200",children:[e.jsx(c,{type:"button",onClick:I,disabled:p,variant:"outline",className:"w-full sm:w-auto order-2 sm:order-1",children:"Annuler"}),e.jsx(c,{type:"submit",disabled:p,className:"w-full sm:w-auto order-1 sm:order-2",children:p?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Modification en cours..."]}):"Modifier client"})]})]})})]})};export{ce as default};
