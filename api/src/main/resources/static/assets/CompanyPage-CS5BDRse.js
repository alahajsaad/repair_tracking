import{c as D,e as F,r as g,j as e,y as C}from"./index-yGwYt6Nq.js";import{u as w}from"./useQuery-wnBeM4WK.js";import{u as P}from"./useMutation-B29Hiwaj.js";import{b as M,B,r as L}from"./request-DFzFQ-HD.js";import{C as Q,a as K}from"./Card-v3_dQfcZ.js";import{b as O,z as h,u as G,s as V}from"./index-DPb_3Eze.js";import{I as E}from"./Input-BljE3152.js";import{B as _}from"./Button-nvBNfKxG.js";import{X as H}from"./x-D4ZDirHF.js";import{M as $}from"./Modal-p6Bw6WIw.js";import"./index-D4j-s7ve.js";/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],X=D("upload",J),W=s=>M({...s,baseURL:B,responseType:"blob"}).then(r=>r.data),A=s=>{const r=new FormData;return r.append("companyName",s.companyName),r.append("companyAddress",s.companyAddress),r.append("companyPhoneNumber",s.companyPhoneNumber),r.append("companyEmail",s.companyEmail),r.append("generalConditions",s.generalConditions||""),s.logo&&s.logo instanceof File&&r.append("logo",s.logo),r},Y=s=>{const r=A(s);return L({url:"/company",method:"post",headers:{"Content-Type":"multipart/form-data"},data:r})},Z=s=>{const r=A(s);return L({url:"/company",method:"put",headers:{"Content-Type":"multipart/form-data"},data:r})},ee=s=>W({url:`/company/files/${s}`,method:"get"}),se=()=>L({url:"/company/exists",method:"get"}),re=()=>L({url:"/company",method:"get"}),te=()=>{const s=F();return P({mutationFn:async r=>{console.log("company :"+r);const o=await Y(r);if(o.status==="error")throw new Error(o.message);return o},onSuccess:r=>{s.setQueryData(["company"],r.data),s.setQueryData(["isCompanyExist"],{status:"success",data:!0}),s.invalidateQueries({queryKey:["companyLogo"]})}})},ne=()=>{const s=F();return P({mutationFn:async r=>{const o=await Z(r);if(o.status==="error")throw new Error(o.message);return o},onSuccess:()=>{s.invalidateQueries({queryKey:["company"]}),s.invalidateQueries({queryKey:["companyLogo"]})}})},R=s=>w({queryKey:["companyLogo",s],queryFn:()=>ee(s),enabled:!!s,gcTime:1/0,staleTime:1/0}),oe=()=>w({queryKey:["company"],queryFn:()=>re().then(s=>{if(s.status==="error")throw new Error(s.message);return s.data}),gcTime:1/0,staleTime:1/0}),ae=()=>w({queryKey:["isCompanyExist"],queryFn:()=>se().then(s=>{if(s.status==="error")throw new Error(s.message);return s.data}),gcTime:1/0,staleTime:1/0}),le=({name:s,label:r,control:o,testId:y})=>{const m=g.useId(),t=g.useRef(null),{field:i}=O({name:s,control:o}),[c,d]=g.useState(i.value||null),p=b=>{var f;const a=((f=b.target.files)==null?void 0:f[0])||null;d(a),i.onChange(a)},u=()=>{d(null),i.onChange(null),t.current&&(t.current.value="")};return e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:m,className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:r}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{htmlFor:m,className:"flex items-center gap-2 px-4 py-2 w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg cursor-pointer dark:bg-gray-700 dark:border-gray-600 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600",children:[e.jsx(X,{className:c?"text-green-600":"text-blue-600",size:18}),c?c.name:"Choose a file"]}),c&&e.jsx("button",{onClick:u,type:"button",className:"absolute top-1/2 right-4 -translate-y-1/2 text-red-600 hover:bg-red-100 p-2 rounded-full focus:outline-none cursor-pointer transition","aria-label":"Remove file",children:e.jsx(H,{size:18})})]}),e.jsx("input",{id:m,ref:t,type:"file","data-testid":y,className:"hidden",onChange:p})]})},ie=()=>h.object({companyName:h.string().min(1,"Ajouter le nom de votre entreprise"),companyAddress:h.string().min(1,"Ajouter le numéro fiscal de votre entreprise"),companyEmail:h.string().email("L'email doit être rempli correctement"),companyPhoneNumber:h.string().min(8,"Le numéro de téléphone doit contenir au moins 8 caractères"),generalConditions:h.string().min(1,"Les conditions générales sont requises"),logo:h.any().optional().refine(s=>!s||s instanceof File&&s.size>0,"Veuillez importer un fichier valide.").refine(s=>!s||["image/jpeg","image/png","image/jpg"].includes(s.type),"Le fichier doit être une image JPG ou PNG.")}),k=({initialCompany:s,onUpdateSuccess:r})=>{const{mutate:o,isPending:y}=te(),{mutate:m,isPending:t}=ne(),{data:i,isPending:c}=R((s==null?void 0:s.logoUrl)||""),[d,p]=g.useState(null),[u,b]=g.useState(!1),a=!!s,f=a?t:y,q=ie(),{register:j,handleSubmit:U,control:I,formState:{errors:l},reset:S,watch:T}=G({resolver:V(q),defaultValues:a&&s?{companyName:s.companyName,companyAddress:s.companyAddress,companyEmail:s.companyEmail,companyPhoneNumber:s.companyPhoneNumber,generalConditions:s.generalConditions}:void 0}),N=T("logo");g.useEffect(()=>{if(a&&i&&!u){const n=URL.createObjectURL(i);return p(n),()=>URL.revokeObjectURL(n)}},[i,a,u]),g.useEffect(()=>{if(N&&N instanceof File){const n=URL.createObjectURL(N);return p(n),b(!0),()=>URL.revokeObjectURL(n)}},[N]);const z=n=>{if(a&&s){const v={companyName:n.companyName,companyAddress:n.companyAddress,companyPhoneNumber:n.companyPhoneNumber,companyEmail:n.companyEmail,generalConditions:n.generalConditions,...u&&{logo:n.logo}};m(v,{onSuccess:x=>{r==null||r(),C.success(x.message)},onError:x=>{C.error(x.message)}})}else{const v={companyName:n.companyName,companyAddress:n.companyAddress,companyPhoneNumber:n.companyPhoneNumber,companyEmail:n.companyEmail,generalConditions:n.generalConditions,logo:n.logo};console.log(v.generalConditions),o(v,{onSuccess:x=>{C.success(x.message),S(),p(null),b(!1)},onError:x=>{C.error(x.message)}})}};return e.jsx(Q,{className:"shadow-lg",children:e.jsx(K,{children:e.jsxs("form",{className:"space-y-6",onSubmit:U(z),children:[e.jsxs("div",{children:[e.jsx(E,{placeholder:"",label:"Nom de l'entreprise",...j("companyName")}),l.companyName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.companyName.message})]}),e.jsxs("div",{children:[e.jsx(E,{placeholder:"",label:"Adresse de l'entreprise",...j("companyAddress")}),l.companyAddress&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.companyAddress.message})]}),e.jsxs("div",{children:[e.jsx(E,{label:"Numero de telephone",...j("companyPhoneNumber")}),l.companyPhoneNumber&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.companyPhoneNumber.message})]}),e.jsxs("div",{children:[e.jsx(E,{type:"email",label:"Email",...j("companyEmail")}),l.companyEmail&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.companyEmail.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Conditions générales"}),e.jsx("textarea",{...j("generalConditions"),rows:4,className:"w-full border border-gray-300 rounded-md p-2 text-sm focus:ring focus:ring-blue-200",placeholder:"Entrez chaque condition separer avec un /"})]}),e.jsxs("div",{children:[a&&d&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo actuel"}),e.jsx("div",{className:"w-32 h-32 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden border-2 border-gray-200",children:c?e.jsx("div",{className:"text-gray-500 text-sm",children:"Chargement..."}):e.jsx("img",{src:d,alt:"Logo de l'entreprise",className:"w-full h-full object-cover"})}),u&&e.jsx("p",{className:"text-sm text-blue-600 mt-2",children:"Nouveau logo sélectionné"})]}),e.jsx(le,{name:"logo",label:`Logo d'entreprise ${a?"(optionnel - laissez vide pour garder l'actuel)":""}`,control:I,testId:"upload-input"}),l.logo&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:typeof l.logo.message=="string"?l.logo.message:"Erreur avec l'upload du logo"})]}),e.jsx("div",{className:"flex justify-end mt-[20px]",children:e.jsx(_,{type:"submit",disabled:f,children:f?"En cours...":a?"Modifier":"Créer"})})]})})})},be=()=>{const[s,r]=g.useState(!1),{data:o,isLoading:y,error:m}=ae(),{data:t,isLoading:i,error:c}=oe(),{data:d,isLoading:p}=R((t==null?void 0:t.logoUrl)||""),u=()=>{r(!1)};return y?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-lg",children:"Vérification du statut de l'entreprise..."})}):m?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-red-500",children:["Erreur lors de la vérification du statut de l'entreprise : ",m.message]})}):o?i?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-lg",children:"Chargement des détails de l'entreprise..."})}):c?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-red-500",children:["Erreur lors du chargement de l'entreprise : ",c.message]})}):e.jsxs("div",{className:"container mx-auto px-4 py-8 bg-white rounded-lg shadow-md",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Détails de l'entreprise"}),e.jsx("button",{onClick:()=>r(!0),className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors",children:"Mettre à jour l'entreprise"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center",children:(t==null?void 0:t.logoUrl)&&e.jsx("div",{className:"w-48 h-48  rounded-lg flex items-center justify-center overflow-hidden",children:p?e.jsx("div",{className:"text-gray-500",children:"Chargement du logo..."}):d?e.jsx("img",{src:URL.createObjectURL(d),alt:"Logo de l'entreprise",className:"w-full h-full object-cover"}):e.jsx("div",{className:"text-gray-500",children:"Aucun logo disponible"})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nom de l'entreprise : ",e.jsx("span",{className:"font-bold",children:t==null?void 0:t.companyName})]})}),e.jsx("div",{children:e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Adresse : ",e.jsx("span",{className:"font-bold",children:t==null?void 0:t.companyAddress})]})}),e.jsx("div",{children:e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Numéro de téléphone : ",e.jsx("span",{className:"font-bold",children:t==null?void 0:t.companyPhoneNumber})]})}),e.jsx("div",{children:e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Email : ",e.jsx("span",{className:"font-bold",children:t==null?void 0:t.companyEmail})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conditions générales"}),e.jsx("div",{className:"text-lg text-gray-900 border border-gray-200 p-3 rounded-lg h-full min-h-[300px]",children:t==null?void 0:t.generalConditions})]})]})]}),e.jsx($,{title:"Mettre à jour votre entreprise",isOpen:s,onClose:()=>r(!1),size:"lg",children:e.jsx(k,{initialCompany:t,onUpdateSuccess:u})})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(k,{})})})};export{be as default};
