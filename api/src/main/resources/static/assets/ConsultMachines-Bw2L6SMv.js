import{h as I,r as i,j as e,y as h,M as w}from"./index-yGwYt6Nq.js";import{b as P,c as E,S as F,d as z}from"./hook-BZgDK58P.js";import{M as C}from"./Modal-p6Bw6WIw.js";import{T as R}from"./Table-jwmTVb_L.js";import{I as b}from"./Input-BljE3152.js";import{B as k}from"./Button-nvBNfKxG.js";import{u as M,s as T,z as j}from"./index-DPb_3Eze.js";import{T as D}from"./TableNav-Di70hy7L.js";import{F as A,S as B}from"./separator-BiM5QLhO.js";import{X as L}from"./x-D4ZDirHF.js";import"./SearchInput-BCy2dsEd.js";import"./utils-B63l6kq4.js";import"./hooks-D8JWOBQf.js";import"./useQuery-wnBeM4WK.js";import"./api-CwCx7HfZ.js";import"./request-DFzFQ-HD.js";import"./useMutation-B29Hiwaj.js";import"./api-Dtxjj7pN.js";import"./index-D4j-s7ve.js";import"./index-Y2e7ilkQ.js";function v(){const[s,t]=I(),c=s.get("partnerId")?parseInt(s.get("partnerId")):void 0,l=s.get("page")?parseInt(s.get("page")):0,r=s.get("size")?parseInt(s.get("size")):8,d=i.useCallback(n=>{t(o=>(n!==void 0?o.set("partnerId",n.toString()):o.delete("partnerId"),o))},[t]),m=i.useCallback(n=>{t(o=>(n!==void 0?o.set("page",n.toString()):o.delete("page"),o))},[t]),f=i.useCallback(n=>{t(o=>(n!==void 0?o.set("size",n.toString()):o.delete("size"),o))},[t]),p=i.useCallback(()=>{t(n=>(n.delete("partnerId"),n.set("page","0"),n.set("size","8"),n))},[t]);return{partnerId:c,page:l,size:r,setPartnerId:d,setPage:m,setSize:f,reset:p}}const O=j.object({designation:j.string().min(1,"Remplir le champ avec une désignation correcte"),reference:j.string().min(1,"Remplir le champ avec une référence correcte")}),G=({initialMachine:s,onUpdateSuccess:t})=>{const{register:c,handleSubmit:l,formState:{errors:r},reset:d}=M({defaultValues:{designation:(s==null?void 0:s.designation)||"",reference:(s==null?void 0:s.reference)||""},resolver:T(O)}),{mutate:m,isPending:f}=P();i.useEffect(()=>{s&&d({designation:s.designation||"",reference:s.reference||""})},[s,d]);const p=n=>{if(!s){h.error("Aucune machine sélectionnée");return}const o={...s,designation:n.designation,reference:n.reference};m(o,{onSuccess:g=>{h.success(g.message),t==null||t(g.data)},onError:g=>{h.error(g.message||"Erreur lors de la mise à jour")}})};return e.jsxs("form",{className:"space-y-6",onSubmit:l(p),children:[e.jsxs("div",{children:[e.jsx(b,{label:"Désignation *",...c("designation")}),r.designation&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.designation.message})]}),e.jsxs("div",{children:[e.jsx(b,{label:"Référence *",...c("reference")}),r.reference&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.reference.message})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(k,{type:"submit",disabled:f,children:f?"En cours...":"Modifier"})})]})},U=({machines:s})=>{const[t,c]=i.useState(s),[l,r]=i.useState(),[d,m]=i.useState(!1),{mutate:f}=E();i.useEffect(()=>{c(s)},[s]);const p=["Client","Designation","Reference"],n=a=>a.entityType==="PERSON"?a.fullName:a.companyName,o=i.useMemo(()=>t.map(a=>({id:a.id,partner:n(a.partner),designation:a.designation,reference:a.reference})),[t]),g=a=>{const u=t.find(x=>x.id===a.id);r(u),m(!0)},y=a=>{f(a,{onSuccess:u=>{h.success(u.message),c(x=>x.filter(S=>S.id!==a))},onError:u=>{h.error(u.message)}})},N=a=>{c(u=>u.map(x=>x.id===a.id?a:x)),m(!1),r(void 0)};return e.jsxs(e.Fragment,{children:[e.jsx(R,{head:p,data:o,variant:"WithActions",onDelete:y,onEdit:g}),e.jsx(C,{title:"Modifier détail de la machine",isOpen:d,onClose:()=>m(!1),size:"md",children:e.jsx(G,{onUpdateSuccess:N,initialMachine:l})})]})},V=()=>{const[s,t]=i.useState(),{setPartnerId:c,reset:l}=v();i.useEffect(()=>{s!=null&&s.id&&c(s.id)},[s,c]);const r=()=>{t(void 0),l()};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),"Filtres"]})}),e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row w-full gap-4 items-end",children:[e.jsx("div",{className:"w-full lg:w-3/5",children:e.jsx(F,{label:"Rechercher un client",partner:s,setPartner:t,partnerType:"CLIENT"})}),e.jsx("div",{className:"w-full lg:w-1/5 flex justify-end",children:e.jsxs("button",{className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-200 rounded-lg transition-all text-sm font-medium flex items-center gap-1",onClick:r,children:[e.jsx(L,{className:"w-4 h-4"}),"Réinitialiser"]})})]})})]})},le=()=>{const{partnerId:s,page:t,size:c,setPage:l}=v(),{data:r,isPending:d}=z({partnerId:s,page:t,size:c});return e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsx(B,{className:"mt-2 mb-2"}),d?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):r&&r.content.length>0?e.jsxs(e.Fragment,{children:[e.jsx(U,{machines:r==null?void 0:r.content,isPending:d}),e.jsx(D,{data:r,page:t,setPage:l})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(w,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Aucune Machine trouvée."})]})]})};export{le as default};
