import{c as b,W as j,M as v,U as w,j as e,a as N,y as u}from"./index-yGwYt6Nq.js";import{C,S as x}from"./index-EgUFrByA.js";import{C as h,a as g}from"./card-Cp2UR_co.js";import{u as S}from"./useQuery-wnBeM4WK.js";import{g as T,u as k,a as B,b as P}from"./hooks-DhN4L3JL.js";import{g as R}from"./api-Dtxjj7pN.js";import{g as $}from"./api-CwCx7HfZ.js";import{g as D}from"./utils-B63l6kq4.js";import{B as m}from"./Button-nvBNfKxG.js";import{u as I}from"./useReparationReportPdf-B5usvG3v.js";import{U as E,P as M}from"./user-Bd4vM0qs.js";import{I as q}from"./Input-BljE3152.js";import{u as A,s as F,z as p}from"./index-DPb_3Eze.js";import{C as U,a as _}from"./Card-v3_dQfcZ.js";import"./index-D4j-s7ve.js";import"./index-CIc1txwD.js";import"./index-Y2e7ilkQ.js";import"./request-DFzFQ-HD.js";import"./useMutation-B29Hiwaj.js";/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],G=b("arrow-right",z);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],L=b("settings",V),W=()=>S({queryKey:["allStatistics"],queryFn:async()=>{try{const[s,t,n]=await Promise.all([T(),R(),$()]);return{reparationCount:s,machineCount:t,partnerCount:n}}catch(s){throw new Error(`Erreur lors de la récupération des statistiques: ${s instanceof Error?s.message:"Erreur inconnue"}`)}},gcTime:1/0,staleTime:1e3*60*15}),K=()=>{const{data:s,isPending:t}=W(),n=[{title:"Nombre de réparations",value:(s==null?void 0:s.reparationCount)||0,description:"Total des réparations",changeType:"neutral",icon:j},{title:"Nombre de machines",value:(s==null?void 0:s.machineCount)||0,description:"Total des machines",changeType:"neutral",icon:v},{title:"Nombre de clients",value:(s==null?void 0:s.partnerCount)||0,description:"Total des clients",changeType:"neutral",icon:w}],l=r=>{switch(r){case"positive":return"!bg-green-50 !border-green-300";case"warning":return"!bg-yellow-50 !border-yellow-300";case"negative":return"!bg-red-50 !border-red-300";default:return"!bg-blue-50 !border-blue-300"}},i=r=>{switch(r){case"positive":return"text-green-700";case"warning":return"text-yellow-700";case"negative":return"text-red-700";default:return"text-blue-700"}},c=r=>{switch(r){case"positive":return"text-green-600";case"warning":return"text-yellow-600";case"negative":return"text-red-600";default:return"text-blue-600"}};return t?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(3)].map((r,o)=>e.jsx(h,{className:"!bg-blue-200 !border-blue-300 animate-pulse",children:e.jsxs(g,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"h-8 w-8 bg-gray-300 rounded"}),e.jsx("div",{className:"h-8 w-16 bg-gray-300 rounded"})]}),e.jsx("div",{className:"h-6 bg-gray-300 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4"})]})},o))}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map((r,o)=>{const d=r.icon;return e.jsx(h,{className:`border-2 ${l(r.changeType)}`,children:e.jsxs(g,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(d,{className:`h-8 w-8 ${c(r.changeType)}`}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:r.value})]}),e.jsx("div",{className:"text-sm font-medium text-gray-800 mb-1",children:r.title}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:`text-xs font-medium ${i(r.changeType)}`,children:r.description})})]})},o)})})},Q=()=>{const{data:s,isPending:t}=k(),{mutate:n}=B(),{isLoading:l,error:i,setSelectedReparation:c}=I(),r=N(),o=a=>{c(a)},d=a=>{n(a)};return e.jsx("div",{className:"p-4",children:t?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s&&s.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:s.map(a=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-6 hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"w-5 h-5 text-blue-600"}),e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["N° ",a.callNumber]})]}),e.jsx("button",{onClick:()=>d(a.id),className:"border-2 border-green-600 hover:bg-green-50 text-green-600 p-2 rounded transition-colors duration-200 cursor-pointer",title:"Marquer comme livré",children:e.jsx(C,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:a.machine.designation}),e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(E,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 font-medium",children:D(a.machine.partner)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Téléphones"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 ml-6",children:a.machine.partner.phoneNumbers.map((f,y)=>e.jsx("span",{className:"text-sm text-gray-700 bg-gray-50 px-3 py-1 rounded-full border",children:f.number},y))})]})]}),e.jsx("div",{className:"pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{onClick:()=>r(`/reparations/${a.id}`),children:"Details"}),e.jsx(m,{onClick:()=>o(a),disabled:l,children:l?"Génération...":"Voir fiche de réparation"}),i&&e.jsxs("p",{className:"text-red-500 text-sm mt-2",children:["Erreur : ",i.message]})]})})]},a.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-gray-50 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4",children:e.jsx(j,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Aucune réparation à livrer"}),e.jsx("p",{className:"text-gray-600",children:"Toutes les réparations complètes sont livrées"})]})})},X=p.object({callNumber:p.string().min(1,"numero d'appel doit etre correct")}),H=()=>{const s=N(),{register:t,handleSubmit:n,formState:{errors:l}}=A({resolver:F(X)}),i=async c=>{try{const r=await P(c.callNumber);r!=null&&r.data?s(`/reparations/${r.data.id}`):u.warn(`Il n'y a pas de réparation avec ce numéro : ${c.callNumber}`)}catch(r){console.error(r),u.error("Une erreur est survenue lors de la recherche de la réparation.")}};return e.jsx(U,{children:e.jsx(_,{children:e.jsxs("form",{className:"flex flex-col gap-2",onSubmit:n(i),children:[e.jsx("p",{children:"Numero d'appel :"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{placeholder:"EX:25A001",...t("callNumber")}),e.jsx(m,{type:"submit",className:"",children:e.jsx(G,{})})]}),l.callNumber&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.callNumber.message})]})})})},ge=()=>e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsx(x,{className:"pt-4 pb-4"}),e.jsx(H,{}),e.jsx(x,{className:"pt-4 pb-4"}),e.jsx(Q,{})]});export{ge as default};
