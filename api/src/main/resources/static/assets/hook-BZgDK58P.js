import{r as s,j as a,e as k}from"./index-yGwYt6Nq.js";import{S as C}from"./SearchInput-BCy2dsEd.js";import{c as P}from"./utils-B63l6kq4.js";import{a as F}from"./hooks-D8JWOBQf.js";import{u as b}from"./useQuery-wnBeM4WK.js";import{u as x}from"./useMutation-B29Hiwaj.js";import{d as q,u as I,a as K,b as N,c as R}from"./api-Dtxjj7pN.js";const D=({data:e,showedAttribute:t,setSelectedItem:n,isOpen:d,setIsOpen:i})=>{const l=s.useRef(null);return s.useEffect(()=>{const r=c=>{const m=c.target;l.current&&!l.current.contains(m)&&i(!1)};return d&&document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[d,i]),a.jsx(a.Fragment,{children:d&&a.jsx("ul",{ref:l,role:"listbox",className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg dark:bg-gray-700 dark:border-gray-600",children:e!=null&&e.length?e.map((r,c)=>a.jsx("li",{role:"option",className:"px-4 py-2 text-sm text-gray-700 cursor-pointer hover:bg-blue-100 dark:text-white dark:hover:bg-gray-600",onClick:()=>n(r),children:t.map((m,o)=>a.jsxs("span",{children:[String(r[m]),o<t.length-1?" / ":""]},o))},c)):a.jsx("li",{className:"px-4 py-2 text-sm text-gray-500 dark:text-gray-300",children:"Aucun rÃ©sultat"})})})},U=({partnerType:e,setPartner:t,partner:n,label:d})=>{const[i,l]=s.useState(),[r,c]=s.useState(),[m,o]=s.useState(!1),[g,f]=s.useState(null),y=s.useRef(!1),{data:h,isPending:w,refetch:S}=F({keyword:i,partnerType:e,page:0,size:10}),M=P((h==null?void 0:h.content)||[]);s.useEffect(()=>{n||(f(null),c(void 0))},[n]),console.log(n),console.log(r),s.useEffect(()=>{i&&!g&&S()},[i,S,g]);const p=s.useCallback(u=>{if(y.current){y.current=!1;return}c(u),l(u),f(null),u.trim()!==""?o(!0):o(!1)},[]),j=u=>{y.current=!0,f(u),t(h==null?void 0:h.content.find(E=>E.id===u.id)),c(u.partnerName),o(!1)},v=()=>{g&&(f(null),c(void 0),l(void 0)),r!=null&&r.trim()&&o(!0)};return a.jsxs("div",{className:"relative",children:[a.jsx(C,{placeholder:e==="SUPPLIER"?"Rechercher un fournisseur...":"Rechercher un client...",setSearchKey:p,isPending:w,value:r,onfocus:v,label:d}),a.jsx(D,{data:M,setSelectedItem:j,isOpen:m,setIsOpen:o,showedAttribute:["partnerName"]})]})},O=()=>{const e=k();return x({mutationFn:t=>K(t).then(n=>{if(n.status==="error")throw new Error(n.message);return n}),onSuccess:()=>{e.invalidateQueries({queryKey:["machines"],refetchType:"active"})}})},H=()=>x({mutationFn:e=>I(e).then(t=>{if(t.status==="error")throw new Error(t.message);return t})}),J=e=>b({queryKey:["clientMachines",e],queryFn:()=>N(e).then(t=>{if(t.status==="error")throw new Error(t.message);return t}),enabled:!!e&&e>0}),V=e=>b({queryKey:["machines",e],queryFn:()=>R(e),gcTime:1/0,staleTime:1e3*60*15,refetchOnMount:"always"}),W=()=>x({mutationFn:e=>q(e)});export{U as S,O as a,H as b,W as c,V as d,J as u};
