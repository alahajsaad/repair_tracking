import{r as m,j as e,M as g,y as o}from"./index-yGwYt6Nq.js";import{I as l}from"./Input-BljE3152.js";import{B as b}from"./Button-nvBNfKxG.js";import{z as t,u as y,s as N}from"./index-DPb_3Eze.js";import{C as S,a as v}from"./Card-v3_dQfcZ.js";import{a as I,S as E}from"./hook-BZgDK58P.js";import"./SearchInput-BCy2dsEd.js";import"./utils-B63l6kq4.js";import"./hooks-D8JWOBQf.js";import"./useQuery-wnBeM4WK.js";import"./api-CwCx7HfZ.js";import"./request-DFzFQ-HD.js";import"./useMutation-B29Hiwaj.js";import"./api-Dtxjj7pN.js";const M=t.object({designation:t.string().min(1,"La désignation est obligatoire"),reference:t.string().min(1,"La référence est obligatoire"),partnerId:t.coerce.number().min(1,"Veuillez sélectionner un client")}),G=()=>{const[r,u]=m.useState(),{mutate:x}=I(),{register:i,handleSubmit:h,reset:p,setValue:a,formState:{errors:s,isSubmitting:d}}=y({resolver:N(M)});m.useEffect(()=>{r!=null&&r.id&&a("partnerId",r==null?void 0:r.id,{shouldValidate:!0,shouldDirty:!0})},[r,a]);const f=c=>{if(!r){o.error("Partner is missing");return}const j={designation:c.designation,reference:c.reference,partner:{id:r==null?void 0:r.id,entityType:r==null?void 0:r.entityType}};x(j,{onSuccess:n=>{o.success(n.message),p()},onError:n=>{o.error(n.message)}})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl ",children:e.jsx(g,{className:"h-6 w-6 text-white"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Ajouter une Machine"})})]}),e.jsx(S,{children:e.jsx(v,{children:e.jsxs("form",{className:"space-y-6 pt-5",onSubmit:h(f),children:[e.jsxs("div",{children:[e.jsx(l,{label:"Nom de la machine *",...i("designation")}),s.designation&&e.jsx("p",{className:"text-red-500",children:s.designation.message})]}),e.jsxs("div",{children:[e.jsx(l,{label:"Référence *",...i("reference")}),s.reference&&e.jsx("p",{className:"text-red-500",children:s.reference.message})]}),e.jsxs("div",{children:[e.jsx(E,{label:"Rechercher un client *",partnerType:"CLIENT",partner:r,setPartner:u}),e.jsx("input",{type:"hidden",...i("partnerId")}),s.partnerId&&e.jsx("p",{className:"text-red-500",children:s.partnerId.message})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(b,{type:"submit",disabled:d,children:d?"En cours...":"Ajouter"})})]})})})]})};export{G as default,M as formSchema};
